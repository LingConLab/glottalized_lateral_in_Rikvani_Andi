---
title: "Glottalized lateral in Rikvani Andi: an acoustic study"
author: "A. Shiryaev, M. Daniel, G. Moroz"
output:
  html_document: default
date: "2022-08-14"
---

[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.4067126.svg)](https://doi.org/10.5281/zenodo.4067126)

To access audio recordings and praat annotations used in the study, please contact the authors: Alexander Shiryaev (ashiryaev87@gmail.com), Michael Daniel (misha.daniel@gmail.com) and George Moroz (agricolamz@gmail.com).

```{r Libraries, include=FALSE}
# include all libraries
knitr::opts_chunk$set(echo = TRUE)
library (readxl)
library(tidyverse)
library(lme4)
library(lmerTest)
library(effects)
library(tinytex)
library(knitr)
library(kableExtra)
```

```{r Input data, include=FALSE}
# read the data
fnames <- c ("07_M35_M40_free_narr", "08_M69_free_narr", "09_M69_free_narr",
             "14_F45_free_narr", "17_F45_free_narr", "18_F45_free_narr",
             "21_F45_free_narr", "35_M35_free_narr", "82_M75_free_narr",
             "84_M75_free_narr", "F30_ind_wrd_carr_phr",
             "F45_ind_wrd_carr_phr", "F49_ind_wrd_carr_phr", "M50_ind_wrd_carr_phr",
             "M52_ind_wrd_carr_phr", "M60_ind_wrd_carr_phr", "M69_ind_wrd_carr_phr"
)

# ---- VARIABLES ----

data_pulses <- data.frame()
data_sounds <- data.frame()

# ---- READ THE DATA ----

data_syllables <-read.table(paste("_ Syllables.txt", sep = ""), header = TRUE, sep = " ", dec = ".", encoding = "UTF-8", quote = "\"")
data_syllables$syllable_type[data_syllables$syllable_type != 0] <- "closed"
data_syllables$syllable_type[data_syllables$syllable_type == 0] <- "open"

for (k in seq(1, length(fnames))){
  if (k == 1) {
    data_pulses <- read.table(paste(fnames[k], "_Pulse_data.txt", sep = ""), header = TRUE, sep = "\t", dec = ".", encoding = "UTF-8", quote = "\"")
    data_sounds <- read.table(paste(fnames[k], "_Sound_data.txt", sep = ""), header = TRUE, sep = "\t", dec = ".", encoding = "UTF-8", quote = "\"")
  }
  else {
    data_pulses_tmp <- read.table(paste(fnames[k], "_Pulse_data.txt", sep = ""), header = TRUE, sep = "\t", dec = ".", encoding = "UTF-8", quote = "\"")
    data_pulses <- rbind (data_pulses, data_pulses_tmp)    
    data_sounds_tmp <- read.table(paste(fnames[k], "_Sound_data.txt", sep = ""), header = TRUE, sep = "\t", dec = ".", encoding = "UTF-8", quote = "\"")
    data_sounds <- rbind (data_sounds, data_sounds_tmp)    
  }
}

rm (data_pulses_tmp)
rm (data_sounds_tmp)

# ---- COMBINE AND NORMALIZE THE DATA ----

# -- re-arrange levels --
data_sounds$consonant <- factor (data_sounds$consonant, levels = c("l", "lˀ"))
data_sounds$prodType_norm <- data_sounds$prodType
data_sounds$prodType_norm [data_sounds$prodType_norm %in% c("1", "2", "3")] <- "Individual words"
data_sounds$prodType_norm <- factor (data_sounds$prodType_norm, levels = c("Individual words", "Carrier phrase", "Free narrative"))

data_sounds$token_key <- paste (data_sounds$file, data_sounds$token_code, sep = "_")
data_syllables$token_key <- paste (data_syllables$fname, data_syllables$token_code, sep = "_")
data_pulses$token_key <- paste (data_pulses$file, data_pulses$token_code, sep = "_")

data_sounds <- inner_join (data_sounds, select (data_syllables, token_key, syllable_type), by = c("token_key"))

data_sounds$statistics_key <-
  paste (data_sounds$prodType_norm, data_sounds$consonant, sep = ", ")

data_sounds$statistics_key [data_sounds$statistics_key == "Individual words, lˀ"] <- "3Individual words, lˀ"
data_sounds$statistics_key [data_sounds$statistics_key == "Free narrative, lˀ"] <- "1Free narrative, lˀ"
data_sounds$statistics_key [data_sounds$statistics_key == "Individual words, l"] <- "4Individual words, l"
data_sounds$statistics_key [data_sounds$statistics_key == "Free narrative, l"] <- "2Free narrative, l"


data_sounds$cons_prodTypekey <- paste (data_sounds$consonant, data_sounds$prodType_norm, sep = ", ")
data_sounds$cons_prodTypekey <- factor (data_sounds$cons_prodTypekey,
                                        levels = c("lˀ, Individual words",
                                                   "l, Individual words",
                                                   "lˀ, Carrier phrase",
                                                   "l, Carrier phrase",
                                                   "lˀ, Free narrative",
                                                   "l, Free narrative"))

data_sounds$speaker <- factor(data_sounds$speaker,
                              levels = c("F30", "M35", "M40",
                                         "F45", "F49", "M50",
                                         "M52", "M60", "M69",
                                         "M75"))

summary_data <-
  data_pulses %>%
    filter (sound == "l" | sound == "lˀ") %>%
    select (file, token_key, interval_dur, interval_intensity) %>%
    group_by (file, token_key) %>%
    summarise (jitter = sd (interval_dur),
               maxInterval_dur = max (interval_dur),
               minInterval_dur = min (interval_dur),
               shimmer = sd (interval_intensity),
               maxInt_dB = max (interval_intensity),
               minInt_dB = min (interval_intensity))

data_sounds <- inner_join (data_sounds, summary_data, by = c("token_key"))
#data_sounds$int_valley <- data_sounds$maxInt_dB - data_sounds$minInt_dB
data_sounds$int_valley <- data_sounds$v2_max_int - data_sounds$c_min_int
data_sounds$minF0 <- 1 / data_sounds$maxInterval_dur
data_sounds$maxF0 <- 1 / data_sounds$minInterval_dur
data_sounds$F0dip <- data_sounds$maxF0 - data_sounds$minF0

tmp_pulse_data <-
  data_pulses %>% select (token_key, interval_middle, interval_dur)
names(tmp_pulse_data)[names(tmp_pulse_data) == "interval_dur"] <- "maxInterval_dur"
names(tmp_pulse_data)[names(tmp_pulse_data) == "interval_middle"] <- "maxInterval_middle"

data_sounds <- inner_join (data_sounds, tmp_pulse_data, by = c("token_key","maxInterval_dur"))

# delete duplicates
data_sounds <- data_sounds[order(data_sounds[,'token_key'], data_sounds[,'maxInterval_dur']),]
data_sounds <- data_sounds[!duplicated(data_sounds$token_key),]

data_sounds$maxInterval_middle <- data_sounds$maxInterval_middle - data_sounds$Cstart
data_sounds$maxInterval_middle_norm <- data_sounds$maxInterval_middle / (data_sounds$V2start - data_sounds$Cstart)
data_sounds$maxInterval_dur_ms <- data_sounds$maxInterval_dur * 1000
data_sounds$minInterval_dur_ms <- data_sounds$minInterval_dur * 1000

rm (tmp_pulse_data)
rm (summary_data)

data_sounds$Cdur <- data_sounds$V2start - data_sounds$Cstart
data_sounds$Cdur_ms <- data_sounds$Cdur * 1000

data_sounds$creakStart_norm <- (data_sounds$creakStart - data_sounds$Cstart) / data_sounds$Cdur
data_sounds$creakEnd_norm <- (data_sounds$creakEnd - data_sounds$Cstart) / data_sounds$Cdur
data_sounds$creakStart_norm [data_sounds$creakStart == 0] <- 0
data_sounds$creakEnd_norm [data_sounds$creakEnd == 0] <- 0

data_sounds$v2 <- gsub ("\\^", "", data_sounds$v2)
data_sounds$speaker <- factor (data_sounds$speaker, levels = c ("F30", "M35", "M40", "F45",
                                                                "F49", "M50","M52", "M60",
                                                                "M69", "M75"))

# estimate tilt

data_sounds$h2_tilt_left <- as.double(data_sounds$h2_left_db) - as.double(data_sounds$f0_left_db)
data_sounds$a1_tilt_left <- as.double(data_sounds$a1_left_db) - as.double(data_sounds$f0_left_db)
data_sounds$a2_tilt_left <- as.double(data_sounds$a2_left_db) - as.double(data_sounds$f0_left_db)
data_sounds$h2_tilt_mid <- as.double(data_sounds$h2_mid_db) - as.double(data_sounds$f0_mid_db)
data_sounds$a1_tilt_mid <- as.double(data_sounds$a1_mid_db) - as.double(data_sounds$f0_mid_db)
data_sounds$a2_tilt_mid <- as.double(data_sounds$a2_mid_db) - as.double(data_sounds$f0_mid_db)
data_sounds$h2_tilt_right <- as.double(data_sounds$h2_right_db) - as.double(data_sounds$f0_right_db)
data_sounds$a1_tilt_right <- as.double(data_sounds$a1_right_db) - as.double(data_sounds$f0_right_db)
data_sounds$a2_tilt_right <- as.double(data_sounds$a2_right_db) - as.double(data_sounds$f0_right_db)

# estimate maximum tilt

tmp <- data.frame(data_sounds$h2_tilt_left,
                  data_sounds$h2_tilt_right,
                  data_sounds$h2_tilt_mid)
tmp <- apply (tmp, 1, max)
data_sounds$h2_tilt_max <- tmp

tmp <- data.frame(data_sounds$a1_tilt_left,
                  data_sounds$a1_tilt_right,
                  data_sounds$a1_tilt_mid)
tmp <- apply (tmp, 1, max)
data_sounds$a1_tilt_max <- tmp

tmp <- data.frame(data_sounds$a2_tilt_left,
                  data_sounds$a2_tilt_right,
                  data_sounds$a2_tilt_mid)
tmp <- apply (tmp, 1, max)
data_sounds$a2_tilt_max <- tmp

# add lateral data to the pulse data frame

lateral_data <- data_sounds %>%
  select (token_key, Cstart, V2start)

data_pulses <- inner_join(data_pulses, lateral_data, by = c("token_key"))
data_pulses$Cdur <- data_pulses$V2start - data_pulses$Cstart
data_pulses$interval_middle_norm <- (data_pulses$interval_middle - data_pulses$Cstart) / data_pulses$Cdur

data_pulses <- inner_join(data_pulses,
                          select (data_sounds, token_key, maxInterval_dur, maxInterval_dur_ms, maxInterval_middle, maxInterval_middle_norm, syllable_type),
                          by = c("token_key"))

lateral_data <- data_pulses %>%
  select (speaker, sound, interval_dur) %>%
  filter (sound == "l") %>%
  group_by (speaker) %>%
  summarise (l_interval_dur_mean = mean(interval_dur))

lateral_data$l_interval_dur_mean_ms <- lateral_data$l_interval_dur_mean * 1000

data_pulses <- inner_join(data_pulses, lateral_data, by = c("speaker"))
data_sounds <- inner_join(data_sounds, lateral_data, by = c("speaker"))
data_pulses$interval_dur_norm <- data_pulses$interval_dur / data_pulses$l_interval_dur_mean

data_pulses <- inner_join(data_pulses, select(data_sounds, token_key, consonant, prodType_norm), by = "token_key")
data_pulses$interval_dur_ms <- data_pulses$interval_dur * 1000

rm (lateral_data)
rm (tmp)

# clear and replace symbols

#data_sounds$word <- gsub ("'", "ʼ", data_sounds$word)
data_sounds$word <- gsub ("lʼ", "lˀ", data_sounds$word)
data_sounds$word <- gsub ("l'", "lˀ", data_sounds$word)
data_sounds$word <- gsub ("t’", "t'", data_sounds$word)
data_sounds$v1 <- gsub ("\\^", "", data_sounds$v1)
data_sounds$v2 <- gsub ("\\^", "", data_sounds$v2)
```
# Appendix 1. Stimuli list

## Table 1. Stimuli list

```{r Appendix 1, echo = FALSE}
wordlist <- read_excel("_ Wordlist.xlsx")
kable(wordlist) %>% kable_styling (latex_options = "scale_down")
```

# Appendix 2. Pulse and intensity profiles

```{r, echo=FALSE}
# inputs
speakers <- unique(data_sounds$speaker)
speakers <- sort(speakers)
```

```{r Fig. 1, echo=FALSE, warning=FALSE}
for (i in 1:10) {
  p <-
  data_pulses %>% filter (speaker == speakers[i]) %>%
    ggplot () +
    ggtitle(paste("Fig. ", (i * 2 - 1), ". Pulse profile for the speaker ", speakers[i], sep = "")) +
    geom_line (aes (x = interval_middle_norm, y = interval_dur_ms, color = token_key)) +
    geom_vline (xintercept = 1, linetype = "dotted", color = "black") +
    geom_vline (xintercept = 0, linetype = "dotted", color = "black") +
    xlab ("Normalized timing of a segment, lateral in 0-1") +
    ylab ("Interval duration, ms") +
    theme(legend.position = "None") +
    annotate ("text", x = -1, y = 50, label = paste ("Speaker ", speakers[i], sep = ""), size = 4) +
    annotate ("text", x = 0.5, y = 50, label = "/lateral/", size = 4) +
    facet_wrap (~prodType_norm~consonant, ncol = 2)
  print(p)
  
  p <-
  data_pulses %>% filter (speaker == speakers[i]) %>%
    ggplot () +
    ggtitle(paste("Fig. ", (i * 2), ". Intensity profile for the speaker ", speakers[i], sep = "")) +
    geom_line (aes (x = interval_middle_norm, y = interval_intensity, color = token_key)) +
    geom_vline (xintercept = 1, linetype = "dotted", color = "black") +
    geom_vline (xintercept = 0, linetype = "dotted", color = "black") +
    xlab ("Normalized timing of a segment, lateral in 0-1") +
    ylab ("Interval intensity, dB") +
    ylim (35, 80) +
    theme(legend.position = "None") +
    annotate ("text", x = -1, y = 80, label = paste ("Speaker ", speakers[i], sep = ""), size = 4) +
    annotate ("text", x = 0.5, y = 80, label = "/lateral/", size = 4) +
    facet_wrap (~prodType_norm~consonant, ncol = 2)
  print(p)
}
```

# Appendix 3. Effect plots for F45 and M69 mixed effects models

Fig. 21. Effect plot for the longest interval between glottal pulses in a lateral

```{r Fig. 21, echo=FALSE, warning=FALSE}
data_dur_longPulse_statistics <- data_sounds %>% filter (speaker %in% c("F45", "M69") & prodType_norm != "Carrier phrase")

m <- lmer (maxInterval_dur_ms ~ statistics_key + (1|speaker), data = data_dur_longPulse_statistics)
plot(allEffects(m))
```

Fig. 22. Effect plot for normalized intensity of a lateral

```{r Fig. 22, echo=FALSE, warning=FALSE}
data_intensity <- data_sounds %>% filter (v2 == "a" & prodType_norm != "Carrier phrase")

data_intensity_statistics <-
  data_intensity %>% filter (speaker %in% c("F45", "M69") & prodType_norm != "Carrier phrase")

m <- lmer (c_mean_int_norm ~ statistics_key + (1|speaker), data = data_intensity_statistics)
plot(allEffects(m))
```

Fig. 23. Effect plot for duration of a lateral

```{r Fig. 23, echo=FALSE, warning=FALSE}
data_dur_longPulse_statistics <- data_sounds %>% filter (speaker %in% c("F45", "M69") & prodType_norm != "Carrier phrase")

m <- lmer (Cdur_ms ~ statistics_key + (1|speaker), data = data_dur_longPulse_statistics)
plot(allEffects(m))
```

Fig. 24. Effect plot for shimmer

```{r Fig. 24, echo=FALSE, warning=FALSE}
data_dur_longPulse_statistics <- data_sounds %>% filter (speaker %in% c("F45", "M69") & prodType_norm != "Carrier phrase")

m <- lmer (shimmer ~ statistics_key + (1|speaker), data = data_dur_longPulse_statistics)
plot(allEffects(m))
```

Fig. 25. Effect plot for H2-H1 tilt (only speaker F45)
```{r Fig. 25, echo=FALSE, warning=FALSE}
data_tilt_statistics <-
  data_sounds %>% filter (speaker == "F45" & prodType_norm != "Carrier phrase" & !is.na(h2_tilt_max )  & v2 == "a")

m <- lm (h2_tilt_max ~ statistics_key, data = data_tilt_statistics)
plot(allEffects(m))
```

Fig. 26. Effect plot for A1-H1 tilt (only speaker F45)
```{r Fig. 26, echo=FALSE, warning=FALSE}
data_tilt_statistics <-
  data_sounds %>% filter (speaker == "F45" & prodType_norm != "Carrier phrase" & !is.na(a1_tilt_max)  & v2 == "a")

m <- lm (a1_tilt_max ~ statistics_key, data = data_tilt_statistics)
plot(allEffects(m))
```

Fig. 27. Effect plot for A2-H1 tilt (only speaker F45)

```{r Fig. 27, echo=FALSE, warning=FALSE}
data_tilt_statistics <-
  data_sounds %>% filter (speaker == "F45" & prodType_norm != "Carrier phrase" & !is.na(a2_tilt_max)  & v2 == "a")

m <- lm (a2_tilt_max ~ statistics_key, data = data_tilt_statistics)
plot(allEffects(m))
```

## Appendix 4. Analysis of stres

```{r Fig. 28-32, echo=FALSE, warning=FALSE}
data_intensity <- data_sounds %>% filter (v2 == "a" & prodType_norm != "Carrier phrase")
data_intensity %>% filter (speaker != "F30") %>%
  ggplot () +
  ggtitle("Fig. 28. Normalized intensity of the lateral vs syllable type") +
  geom_point(aes (x = cons_prodTypekey, y = c_mean_int_norm, color = syllable_type), position = position_jitter (width = 0.1)) +
  theme (axis.text.x=element_text(angle=55, hjust=1, size = 12),
         axis.title.x = element_blank()) +
  ylab ("Normalized lateral intensity, dB") +
  facet_wrap (~speaker, nrow = 3)

data_sounds %>% filter (speaker != "F30" & prodType_norm != "Carrier phrase") %>%
  ggplot () +
  ggtitle ("Fig. 29. Lateral duration vs syllable type") +
  geom_point(aes (x = cons_prodTypekey, y = Cdur_ms, color = syllable_type), position = position_jitter (width = 0.1)) +
  theme (axis.text.x=element_text(angle=55, hjust=1, size = 12),
         axis.title.x = element_blank()) +
  ylab ("Sound duration, ms") +
  facet_wrap (~speaker, nrow = 3)

data_sounds %>% filter (speaker != "F30" & prodType_norm != "Carrier phrase") %>%
  ggplot () +
  ggtitle("Fig. 30. Duration of the longest interval between glottal pulses vs syllable type") +
  geom_point(aes (x = cons_prodTypekey, y = maxInterval_dur_ms, color = syllable_type), position = position_jitter (width = 0.1)) +
  theme (axis.text.x=element_text(angle=55, hjust=1, size = 12),
         axis.title.x = element_blank()) +
  ylab ("Longest interval duration, ms") +
  facet_wrap (~speaker, nrow = 3)

data_intensity <- data_sounds %>% filter (v2 == "a" & prodType_norm != "Carrier phrase")
data_intensity %>% filter (!is.na(h2_tilt_max) & speaker != "F30" & prodType_norm != "Carrier phrase") %>%
  ggplot () +
  ggtitle ("Fig. 31. H2-H1 spectral tilt vs syllable type") +
  geom_point(aes (x = cons_prodTypekey, y = h2_tilt_max, color = syllable_type), position = position_jitter (width = 0.1)) +
  theme (axis.text.x=element_text(angle=55, hjust=1, size = 9),
         axis.title.x = element_blank()) +
  ylab ("H2-H1 spectral tilt, dB") +
  facet_wrap (~speaker, nrow = 3)

data_sounds %>% filter (speaker != "F30" & prodType_norm != "Carrier phrase") %>%
  ggplot () +
  ggtitle ("Fig. 32. Shimmer vs syllable type") +
  geom_point(aes (x = cons_prodTypekey, y = shimmer, color = syllable_type), position = position_jitter (width = 0.1)) +
  theme (axis.text.x=element_text(angle=55, hjust=1, size = 12),
         axis.title.x = element_blank()) +
  ylab ("Shimmer, dB") +
  facet_wrap (~speaker, nrow = 3)


```

## Appendix 5. Creak spread

```{r Fig. 33, echo=FALSE, warning=FALSE}
data_creak <- data_sounds %>% filter (creakType != "-") %>%
  select (token_code, token_key, prodType_norm, speaker,
          creakStart_norm, creakEnd_norm, maxInterval_dur,
          maxInterval_middle_norm) %>%
  pivot_longer (c ("creakStart_norm", "creakEnd_norm"), names_to = "creakPoint", values_to = "creakInterval")

data_creak$yValue <- 0
data_creak$yValue [data_creak$prodType_norm == "Individual words"] <- 1
data_creak$yValue [data_creak$prodType_norm == "Carrier phrase"] <- 2
data_creak$yValue [data_creak$prodType_norm == "Free narrative"] <- 3
data_creak$yValue <- data_creak$yValue + data_creak$token_code / 50

data_creak %>%
  ggplot() +
  ggtitle ("Fig. 33. Position of creaky parts within the glottalized laterals") +
  geom_line (aes (x = creakInterval, y = yValue, color = token_key)) +
  theme (legend.position = "none") +
  geom_hline (yintercept = 3, linetype = "dotted", size = 0.5) +
  geom_hline (yintercept = 2, linetype = "dotted", size = 0.5) +
  geom_vline (xintercept = 1, linetype = "dotted", size = 0.5) +
  geom_vline (xintercept = 0, linetype = "dotted", size = 0.5) +
  xlim (-0.3, 1.5) +
  xlab ("Position of creak, 0-1 is a lateral") +
  ylab ("") +
  annotate ("text", x = 0.5, y = 2.7, label = "/lateral/", size = 3) +
  annotate ("text", x = 1.2, y = 1.75, label = "Ind. words", size = 3) +
  annotate ("text", x = 1.2, y = 2.75, label = "Carr. phr", size = 3) +
  annotate ("text", x = 1.2, y = 3.75, label = "Free narr", size = 3) +
  facet_wrap (~speaker)
```

Table 2. Creak statistics

```{r Table 2, echo=FALSE, warning=FALSE, message=FALSE}
data_sounds$creakType [data_sounds$creakType == "full stop + creaky"] <- "full stop + creak"
data_sounds$creakType [data_sounds$creakType == "full stop + creak"] <- "full stop"
data_sounds$creakType [data_sounds$creakType == "creak"] <- "creaky"
data_sounds$creakType [data_sounds$creakType == "creak + noisy"] <- "creaky"
data_sounds$creakType [data_sounds$creakType == "creaky + noisy"] <- "creaky"
data_sounds$creakType [data_sounds$creakType == "noisy"] <- "no creak"
data_sounds$creakType [data_sounds$creakType == "-"] <- "no creak"

creakData <-
  data_sounds %>% select (speaker, prodType_norm, consonant, creakType) %>%
  group_by (speaker, prodType_norm, consonant, creakType) %>%
  summarise (n = n())
creakData <-
  pivot_wider (creakData, names_from = creakType, values_from = n)

tmp <- data_sounds %>% filter (creakEnd_norm > 1) %>%
  select (speaker, prodType_norm, consonant) %>%
  group_by (speaker, prodType_norm, consonant) %>%
  summarise (n = n())
creakData <- left_join (creakData, tmp, by = c ("speaker", "prodType_norm", "consonant"))
names(creakData)[names(creakData) == "n"] <- "right creak spread"

tmp <- data_sounds %>% filter (creakStart_norm < 0) %>%
  select (speaker, prodType_norm, consonant) %>%
  group_by (speaker, prodType_norm, consonant) %>%
  summarise (n = n())
creakData <- left_join (creakData, tmp, by = c ("speaker", "prodType_norm", "consonant"))
names(creakData)[names(creakData) == "n"] <- "left creak spread"

rm(tmp)

kable(creakData) %>% kable_styling (latex_options = "scale_down")
```

## Appendix 6. Spectral tilt dynamics

```{r Fig. 34-36, echo=FALSE, warning=FALSE, message=FALSE}
# H2-H1 tilt
data_h2_tilt <- data_sounds %>% filter (prodType != "Carrier phrase" &
                                          !is.na(h2_tilt_max) &
                                          v2 == "a" &
                                          speaker != "M50" &
                                          !(speaker == "M69" & prodType_norm == "Individual words")) %>%
  select (token_key, consonant, prodType_norm, speaker, h2_tilt_left, h2_tilt_mid, h2_tilt_right, left_point, mid_point, right_point, statistics_key) %>%
  pivot_longer (c ("h2_tilt_left", "h2_tilt_mid", "h2_tilt_right"), names_to = "tiltPosition", values_to = "tiltValue")


data_h2_tilt$plotKey <- 0
data_h2_tilt$plotKey [data_h2_tilt$tiltPosition == "h2_tilt_left"] <- 0.1
data_h2_tilt$plotKey [data_h2_tilt$tiltPosition == "h2_tilt_right"] <- 0.5
data_h2_tilt$plotKey [data_h2_tilt$tiltPosition == "h2_tilt_mid"] <- 0.9

data_h2_tilt %>%
  ggplot () +
  ggtitle ("Fig. 34. H2-H1 spectral tilt estimated in points 0.1, 0.5 and 0.9 of sound duration") +
  geom_line(aes (x = plotKey, y = tiltValue, color = token_key), size = 0.05) +
  geom_smooth(aes (x = plotKey, y = tiltValue), color = "black") +
  ylab ("H2 intensity less H1 intensity") +
  theme (legend.position = "none") +
  facet_wrap (~speaker~statistics_key, ncol = 4)

# A1-H1 tilt
data_a1_tilt <- data_sounds %>% filter (prodType != "Carrier phrase" &
                                          !is.na(a1_tilt_max) &
                                          v2 == "a" &
                                          speaker != "M50" &
                                          !(speaker == "M69" & prodType_norm == "Individual words")) %>%
  select (token_key, consonant, prodType_norm, speaker, a1_tilt_left, a1_tilt_mid, a1_tilt_right, left_point, mid_point, right_point, statistics_key) %>%
  pivot_longer (c ("a1_tilt_left", "a1_tilt_mid", "a1_tilt_right"), names_to = "tiltPosition", values_to = "tiltValue")

data_a1_tilt$plotKey <- 0
data_a1_tilt$plotKey [data_a1_tilt$tiltPosition == "a1_tilt_left"] <- 0.1
data_a1_tilt$plotKey [data_a1_tilt$tiltPosition == "a1_tilt_right"] <- 0.5
data_a1_tilt$plotKey [data_a1_tilt$tiltPosition == "a1_tilt_mid"] <- 0.9

data_a1_tilt %>%
  ggplot () +
  ggtitle ("Fig. 35. A1-H1 spectral tilt estimated in points 0.1, 0.5 and 0.9 of sound duration") +
  geom_line(aes (x = plotKey, y = tiltValue, color = token_key), size = 0.05) +
  ylab ("A1 intensity less H1 intensity") +
  geom_smooth(aes (x = plotKey, y = tiltValue), color = "black") +
  theme (legend.position = "none") +
  facet_wrap (~speaker~statistics_key, ncol = 4)

# A2-H1 tilt

data_a2_tilt <- data_sounds %>% filter (prodType != "Carrier phrase"  &
                                          !is.na(a2_tilt_max) &
                                          v2 == "a" &
                                          speaker != "M50" &
                                          !(speaker == "M69" & prodType_norm == "Individual words")) %>%
  select (token_key, consonant, prodType_norm, speaker, a2_tilt_left, a2_tilt_mid, a2_tilt_right, left_point, mid_point, right_point, statistics_key) %>%
  pivot_longer (c ("a2_tilt_left", "a2_tilt_mid", "a2_tilt_right"), names_to = "tiltPosition", values_to = "tiltValue")

data_a2_tilt$plotKey <- 0
data_a2_tilt$plotKey [data_a2_tilt$tiltPosition == "a2_tilt_left"] <- 0.1
data_a2_tilt$plotKey [data_a2_tilt$tiltPosition == "a2_tilt_right"] <- 0.5
data_a2_tilt$plotKey [data_a2_tilt$tiltPosition == "a2_tilt_mid"] <- 0.9

data_a2_tilt %>%
  ggplot () +
  ggtitle ("Fig. 36. A2-H1 spectral tilt estimated in points 0.1, 0.5 and 0.9 of sound duration") +
  geom_line(aes (x = plotKey, y = tiltValue, color = token_key), size = 0.05) +
  ylab ("A2 intensity less H1 intensity") +
  geom_smooth(aes (x = plotKey, y = tiltValue), color = "black") +
  theme (legend.position = "none") +
  facet_wrap (~speaker~statistics_key)
```

## Appendix 7. Praat script

```
Script for extracting sound data

 # the script extracts data for each token of a lateral

form Data extracton parameters
 # sound, word, production type (token), speaker - interval tiers
 # pulse - point tier
 comment Number of the sound tier
 integer sndTier 1
 comment Number of the word tier
 integer wrdTier 2
 comment Number of the production type tier
 integer prodTypeTier 3
 comment Number of the speaker tier
 integer spkTier 6
 comment Pulse tier
 integer plsTier 7
 comment Creak type tier
 integer creakTier 8
 comment Path to formant extraction data
 text formantFile _ Formant_Extraction_Parameters.txt
 comment Path to save spectrograms
 text path C:\Users\ashir\Desktop\_l_Spectrograms\
endform

sound_data_raw = selected ("Sound")
textGrid_data = selected ("TextGrid")

Edit

 # ---- delete the initial word "Sound " from the file name
select sound_data_raw
inpFile$ = selected$ ()
len = length: inpFile$
inpFile$ = right$: inpFile$, len - 6

 # ---- make output file names
outFile$ = inpFile$ + "_Sound_data.txt"

 # ---- resample the sound

select sound_data_raw
Resample... 16000 50
sound_data = selected("Sound")

 # ---- scaling parameters

pctRightBase = 10 ; base width of a spectrogram in Praat picture
pctRightScale = 0.5 ; base duration of a word for scaling, seconds
pctRight = 0

 # ---- variables

fCounter = 0 ; counter for formants
tokenCounter = 1 ; will be used as a key for the tokens
spectrogramFlag = 0
tmpSound = 0


select textGrid_data
nIntervals = Get number of intervals: sndTier ; number of intervals in the sounds tier

 # ---- get formant extraction parameters

str = Read Strings from raw text file... 'formantFile$'

select str
strNum = Get number of strings

fParams$ [1] = "" ; array of formant extraction parameters

if strNum > 1
 for i from 1 to strNum
  fParams$ [i] = Get string: i
 endfor
endif

removeObject: str

 # ---- create intensity object 

selectObject: sound_data
intensity = To Intensity... 100 0

 # ---- make headers

writeFileLine: outFile$, "file", tab$, "token_code", tab$, "speaker", tab$, "word", tab$, "prodType", tab$, "v1", tab$, "v2", tab$, "consonant", tab$,
                   ..."creakType", tab$, "creakStart", tab$, "creakEnd", tab$, "V1start", tab$, "Cstart", tab$, "V2start", tab$, "V2end", tab$,
                   ..."v1_max_int", tab$, "c_min_int", tab$, "v2_max_int", tab$,
                   ..."c_mean_int", tab$, "c_mean_int_norm", tab$,
                   ..."left_point", tab$, "f0_left_hz", tab$, "f0_left_db", tab$, "h2_left_hz", tab$, "h2_left_db", tab$, "a1_left_hz", tab$, "a1_left_db", tab$, "a2_left_hz", tab$, "a2_left_db", tab$,
                   ..."mid_point", tab$, "f0_mid_hz", tab$, "f0_mid_db", tab$, "h2_mid_hz", tab$, "h2_mid_db", tab$, "a1_mid_hz", tab$, "a1_mid_db", tab$, "a2_mid_hz", tab$, "a2_mid_db", tab$,
                   ..."right_point", tab$, "f0_right_hz", tab$, "f0_right_db", tab$, "h2_right_hz", tab$, "h2_right_db", tab$, "a1_right_hz", tab$, "a1_right_db", tab$, "a2_right_hz", tab$, "a2_right_db"

 # ---- the main algorythm

writeInfo: ""

for i from 2 to (nIntervals - 1)

 # -- find sounds in the sound tier
 selectObject: textGrid_data

 snd1$ = Get label of interval: sndTier, i - 1 ; previous sound
 snd2$ = Get label of interval: sndTier, i     ; current sound
 snd3$ = Get label of interval: sndTier, i + 1 ; next sound

 # limits of the previous sound
 snd1Lft = Get start point: sndTier, i - 1 ; the left point of the interval
 snd1Rght = Get end point: sndTier, i - 1 ; the right point of the interval

 # limits of the current sound
 snd2Lft = Get start point: sndTier, i
 snd2Rght = Get end point: sndTier, i

 # limits of the next sound
 snd3Lft = Get start point: sndTier, i + 1
 snd3Rght = Get end point: sndTier, i + 1
	
 # -- check that the sounds are in the same word
 wrdLft = Get interval at time: wrdTier, (snd1Lft + snd2Lft) / 2
 wrdLft$ = Get label of interval: wrdTier, wrdLft
 wrdRght = Get interval at time: wrdTier, (snd3Lft + snd3Rght) / 2
 wrdRght$ = Get label of interval: wrdTier, wrdRght

 # save the spectrogram

 if spectrogramFlag = 1 and wrdRght$ <> wrdLft$
  Select outer viewport: 0, pctRight, 0, 7
  fname$ = path$ + inpFile$ + "_" + string$(tokenCounter) + "_" + wrdLft$ + "_" + spk$ + "_" + prodType$ + ".png"
  Save as 300-dpi PNG file: fname$

  removeObject: tmpTxtGrid
  removeObject: tmpSound

  spectrogramFlag = 0
  tmpSound = 0
 endif

 # -- normalize sound notation
 if snd2$ = "l'"
  snd2$ = "lˀ"
 endif

 # -- check whether the lateral is between 2 sounds and that they all are within one word
 # -- then extract all the necessary data

 if (snd2$ = "l" or snd2$ = "lˀ") and snd1$ <> "" and snd3$ <> "" and wrdLft$ = wrdRght$ and
 ...((length (snd1$) = 1 and length (snd3$) = 1) or 
 ...(left$(snd3$,1) = "^" and length (snd1$) = 1) or
 ...(left$(snd1$,1) = "^" and length (snd3$) = 1))

  spectrogramFlag = 1
  wrdBorderLft = Get start point: wrdTier, wrdLft
  wrdBorderRght = Get end point: wrdTier, wrdLft

  # -- drafting the spectrogram

  # extract the sound and textgrid

  if tmpSound = 0 ; this is the first encounter of V_V
   select sound_data
   Extract part: wrdBorderLft, wrdBorderRght, "rectangular", 1, "no"
   tmpSound = selected("Sound")
  
   select textGrid_data
   Extract part: wrdBorderLft, wrdBorderRght, "no"
   tmpTxtGrid = selected ("TextGrid")

   nPulses = Get number of points: plsTier
   z = 1
   while z <= nPulses
    t = Get time of point: plsTier, z
    if (t < snd1Lft - wrdBorderLft) or (t > snd3Rght - wrdBorderRght)
     Remove point: plsTier, z
     nPulses = Get number of points: plsTier
    else
     z = z + 1
    endif
   endwhile

   # remove the data that is not required
   numberOfTiers = Get number of tiers
   if numberOfTiers = 9
     Remove tier... 9
     Remove tier... 8
   endif
   Remove tier... 5
   Remove tier... 4

   # scaling
   pctRight = pctRightBase * (wrdBorderRght - wrdBorderLft) / pctRightScale

   # draw the spectrogram
   select tmpSound
   plus tmpTxtGrid
   Edit

   Select outer viewport: 0, pctRight, 4, 7
   editor: tmpTxtGrid
    Select: 0, wrdBorderRght - wrdBorderLft
    Draw visible sound and TextGrid: "yes", "no", "yes", "yes", "yes"
   endeditor

   Select outer viewport: 0, pctRight, 0, 4
   editor: tmpTxtGrid
    Select: 0, wrdBorderRght - wrdBorderLft
    # parameters: erase first, write name, draw selection times
    # draw selection hairs, garnish
    Paint visible spectrogram: "no", "no", "yes", "yes", "yes"
   endeditor
  endif

  # -- data extraction

  selectObject: textGrid_data

  prodType = Get interval at time: prodTypeTier, snd2Lft
  prodType$ = Get label of interval: prodTypeTier, prodType
  spk = Get interval at time: spkTier, snd2Lft
  spk$ = Get label of interval: spkTier, spk

  creakType_number = Get number of intervals: creakTier
  creakType = Get interval at time: creakTier, snd1Lft
  if creakType_number > 2 and creakType < creakType_number - 1
   creakType = creakType + 1 ; because we know there cannot be creak in the beginning of the first vowel
   creakStart = Get start point: creakTier, creakType
   creakEnd = Get end point: creakTier, creakType
   creakType$ = Get label of interval: creakTier, creakType
   if creakStart > snd3Rght or creakType$ = ""
    creakStart = 0
    creakEnd = 0
    creakType$ = "-"
   endif
  else
   # there's only one or two intervals in the tier
   creakStart = 0
   creakEnd = 0
   creakType$ = "-"
  endif

  appendFile: outFile$, inpFile$, tab$, tokenCounter, tab$, spk$, tab$, wrdLft$, tab$, prodType$, tab$, snd1$, tab$, snd3$, tab$, snd2$, tab$,
           ...creakType$, tab$, fixed$ (creakStart, 3), tab$, fixed$ (creakEnd, 3), tab$, fixed$ (snd1Lft, 3), tab$, fixed$ (snd2Lft, 3), tab$, fixed$ (snd3Lft, 3), tab$, fixed$ (snd3Rght,3), tab$

  selectObject: intensity
  snd1IntMax = Get maximum: snd1Lft, snd2Lft, "None"
  snd2IntMean = Get mean... snd2Lft snd3Lft dB
  snd2IntMin = Get minimum... snd2Lft snd3Lft None
  snd3IntMax = Get mean... snd3Lft snd3Rght dB

  # -- extract normalized intensity of the consonants

  snd2IntNorm = 0

  @extract_normalized_intensities: sound_data, snd2Lft, snd2Rght, snd3Rght, 70, snd2IntNorm

  appendFile: outFile$, fixed$ (snd1IntMax, 2), tab$, fixed$ (snd2IntMin, 2), tab$, fixed$ (snd3IntMax, 2), tab$,
                   ...fixed$ (snd2IntMean, 2), tab$, fixed$ (snd2IntNorm, 2), tab$

  # -- extract formant data

  if fCounter = 0
   fCounter = 1
   @split (" ", fParams$ [fCounter])
   while split.array$[1] <> inpFile$
    fCounter = fCounter + 1
    @split (" ", fParams$ [fCounter])
   endwhile
   #appendInfoLine: fCounter, tab$, wrdLft$
  else
   fCounter = fCounter + 1
   @split (" ", fParams$ [fCounter])
   appendInfoLine: fCounter, tab$, wrdLft$
  endif

  # estimate formant intensities, draw formants
  for k from 1 to 3
   tiltPlace$ = split.array$[(k-1)*7+2]
   a1_lft_hz$ = split.array$[(k-1)*7+3]
   a1_rght_hz = number (split.array$[(k-1)*7+4])
   a2_lft_hz = number (split.array$[(k-1)*7+5])
   a2_rght_hz = number (split.array$[(k-1)*7+6])
   a3_lft_hz = number (split.array$[(k-1)*7+7])
   a3_rght_hz = number (split.array$[(k-1)*7+8])

   if tiltPlace$ <> "-" and a1_lft_hz$ <> "-"
    tiltTime = snd2Lft + (snd2Rght - snd2Lft) * number(tiltPlace$)
    f0_hz = 0
    @estimate_f0_hz: sound_data, textGrid_data, plsTier, tiltTime, f0_hz
    h2_hz = f0_hz * 2
    a1_hz = 0
    a2_hz = 0
    f0_dB = 0
    h2_dB = 0
    a1_dB = 0
    a2_dB = 0
    if a1_lft_hz$ = "Auto"
     @extract_formants_no_bands: sound_data, tiltTime, f0_hz
     f0_hz = extract_formants_no_bands.f0_hz
     h2_hz = extract_formants_no_bands.h2_hz
     a1_hz = extract_formants_no_bands.a1_hz
     a2_hz = extract_formants_no_bands.a2_hz
     f0_dB = extract_formants_no_bands.f0_dB
     h2_dB = extract_formants_no_bands.h2_dB
     a1_dB = extract_formants_no_bands.a1_dB
     a2_dB = extract_formants_no_bands.a2_dB
    else
     @extract_formants_with_bands: sound_data, tiltTime, number(a1_lft_hz$), a1_rght_hz, a2_lft_hz, a2_rght_hz, f0_hz
     f0_hz = extract_formants_with_bands.f0_hz
     h2_hz = extract_formants_with_bands.h2_hz
     a1_hz = extract_formants_with_bands.a1_hz
     a2_hz = extract_formants_with_bands.a2_hz
     f0_dB = extract_formants_with_bands.f0_dB
     h2_dB = extract_formants_with_bands.h2_dB
     a1_dB = extract_formants_with_bands.a1_dB
     a2_dB = extract_formants_with_bands.a2_dB
    endif
    @draw_formants: f0_hz, h2_hz, a1_hz, a2_hz, (tiltTime - wrdBorderLft)
    appendFile: outFile$, tiltPlace$, tab$, fixed$ (f0_hz, 2), tab$, fixed$ (f0_dB, 2), tab$, fixed$ (h2_hz, 2), tab$, fixed$ (h2_dB, 2), tab$, fixed$ (a1_hz, 2), tab$, fixed$ (a1_dB, 2), tab$, fixed$ (a2_hz, 2), tab$, fixed$ (a2_dB, 2)
   else
    appendFile: outFile$, "-", tab$, "-", tab$, "-", tab$, "-", tab$, "-", tab$, "-", tab$, "-", tab$, "-", tab$, "-"
   endif
   if k < 3
    appendFile: outFile$, tab$
   endif
  endfor
  appendFileLine: outFile$
  tokenCounter = tokenCounter + 1
 endif
endfor

if spectrogramFlag = 1 and wrdRght$ <> wrdLft$
 Select outer viewport: 0, pctRight, 0, 7
 fname$ = inpFile$ + "_" + string$(tokenCounter) + "_" + wrdLft + "_" + spk$ + "_" + prodType$ + ".png"
 Save as 300-dpi PNG file: fname$
 spectrogramFlag = 0
# removeObject: tmpTxtGrid
# removeObject: tmpSound
endif

removeObject: intensity
removeObject: sound_data

selectObject: sound_data_raw, textGrid_data

appendInfoLine: "Done!"

# .sep$ - separator, .str$ the string to be separated
procedure split (.sep$, .str$)
	.strlen = length (.str$)
	.sep = index (.str$, .sep$)
	.seplen = length (.sep$)
	.length = 1
	while .sep > 0
		.part$ = left$ (.str$, .sep - 1)
		.str$ = right$ (.str$, length (.str$) - .sep - .seplen + 1)
		.sep = index (.str$, .sep$)
		.array$ [.length] = .part$
		.length = .length + 1
	endwhile
	.array$ [.length] = .str$
endproc

procedure extract_normalized_intensities: .sound_data, .snd2Lft, .snd2Rght, .snd3Rght, .norm_dB, snd2IntNorm
 select .sound_data
 Extract part: .snd2Lft - 1, .snd3Rght + 1, "rectangular", 1, "yes"
 .tmpSound = selected ("Sound")
 .tmpIntensity = To Intensity... 100 0
 .snd3Int = Get mean... .snd2Rght .snd3Rght dB
 .snd2Int = Get mean... .snd2Lft .snd2Rght dB
 .snd2snd3Int = Get mean... .snd2Lft .snd3Rght dB
 removeObject: .tmpIntensity

 .snd3IntNorm = .norm_dB
 snd2IntNorm = .snd2Int + (.snd3IntNorm - .snd3Int)
 .snd2snd3IntNorm = .snd2snd3Int + (.snd3IntNorm - .snd3Int)

 .loopFlag = 1
 while .loopFlag = 1
  selectObject: .tmpSound
  Scale intensity... .snd2snd3IntNorm
  .tmpIntensity = To Intensity... 100 0

  snd2IntNorm = Get mean... .snd2Lft .snd2Rght dB
  .snd3IntNorm = Get mean... .snd2Rght .snd3Rght dB
  if .snd3IntNorm < 69.5
   .snd2snd3IntNorm = .snd2snd3IntNorm + 1
  endif
  if .snd3IntNorm > 70.5
   .snd2snd3IntNorm = .snd2snd3IntNorm - 1
  endif
  if .snd3IntNorm >= 69.5 and .snd3IntNorm <= 70.5
   .loopFlag = 0
  endif
  removeObject: .tmpIntensity
 endwhile
 removeObject: .tmpSound
endproc

procedure estimate_f0_hz: .sound_data, .textGrid_data, .pulseTier, .tiltPlace, f0_hz
# if pulse interval is greater than 0.02, f0 is undefined
 select .textGrid_data
 .pulse_start_id = 1
 .pulseTime = Get time of point: .pulseTier, .pulse_start_id
 while .pulseTime < .tiltPlace
  .pulse_start_id = .pulse_start_id + 1
  .pulseTime = Get time of point: .pulseTier, .pulse_start_id
 endwhile
 .pulseTime_prev = Get time of point: .pulseTier, (.pulse_start_id - 1)
 if (.pulseTime - .pulseTime_prev) > 0.02
  f0_hz = undefined
 else
  f0_hz = 1 / (.pulseTime - .pulseTime_prev)
 endif
endproc

procedure extract_formants_with_bands: .sound_data, .tiltTime, .a1_left_hz, .a1_right_hz, .a2_left_hz, .a2_right_hz, .f0_hz
 select .sound_data
 Edit
 editor: .sound_data
  Move cursor to: .tiltTime
  View spectral slice
 Close
 .sliceID = selected ("Spectrum")
 .ltasID = To Ltas (1-to-1)

 if .f0_hz <> undefined
  .f0_dB = Get maximum: (.f0_hz * 0.9), (.f0_hz * 1.1), "None"
  .f0_hz = Get frequency of maximum: (.f0_hz * 0.9), (.f0_hz * 1.1), "None"

  .h2_hz = f0_hz * 2
  .h2_dB = Get maximum: (.h2_hz * 0.9), (.h2_hz * 1.1), "None"
 else
  .f0_dB = undefined
  .h2_hz = undefined
  .h2_dB = undefined
 endif

 .a1_dB = Get maximum: .a1_left_hz, .a1_right_hz, "None"
 .a1_hz = Get frequency of maximum: .a1_left_hz, .a1_right_hz, "None"

 .a2_dB = Get maximum: .a2_left_hz, .a2_right_hz, "None"
 .a2_hz = Get frequency of maximum: .a2_left_hz, .a2_right_hz, "None"

 removeObject: .sliceID
 removeObject: .ltasID
endproc

procedure extract_formants_no_bands: .sound_data, .tiltTime, .f0_hz
 select .sound_data
 Edit
 editor: .sound_data
  Move cursor to: .tiltTime
  View spectral slice
 Close
 .sliceID = selected ("Spectrum")
 .ltasID = To Ltas (1-to-1)

 select .sound_data
 Edit
 editor: .sound_data
  Select: (.tiltTime - 0.1), (.tiltTime + 0.1)
  Extract selected sound (preserve times)
 Close
 .tmpSoundID = selected ("Sound")
 .formantID = To Formant (burg)... 0.0025 5 5900 0.025 50
 .a1_hz = Get quantile: 1, (.tiltTime - 0.05), (.tiltTime + 0.05), "Hertz", 0.5
 .a2_hz = Get quantile: 2, (.tiltTime - 0.05), (.tiltTime + 0.05), "Hertz", 0.5

 select .ltasID 

 if .f0_hz = undefined
  .f0_dB = undefined
  .h2_hz = undefined
  .h2_dB = undefined
 else
  .f0_dB = Get maximum: (.f0_hz * 0.9), (.f0_hz * 1.1), "None"
  .f0_hz = Get frequency of maximum: (.f0_hz * 0.9), (.f0_hz * 1.1), "None"

  .h2_hz = .f0_hz * 2
  .h2_dB = Get maximum: (.h2_hz * 0.9), (.h2_hz * 1.1), "None"
 endif

 if .a1_hz = undefined
  .a1_dB = undefined
 else
  .a1_dB = Get maximum: (.a1_hz * 0.9), (.a1_hz * 1.1), "None"
  .a1_hz = Get frequency of maximum: (.a1_hz * 0.9), (.a1_hz * 1.1), "None"
 endif

 if .a2_hz = undefined
  .a2_dB = undefined
 else
  .a2_dB = Get maximum: (.a2_hz * 0.9), (.a2_hz * 1.1), "None"
  .a2_hz = Get frequency of maximum: (.a2_hz * 0.9), (.a2_hz * 1.1), "None"
 endif

 removeObject: .tmpSoundID
 removeObject: .sliceID
 removeObject: .ltasID
 removeObject: .formantID
endproc

procedure draw_formants: .f0_hz, .h2_hz, .a1_hz, .a2_hz, .place
 if .a1_hz <> undefined   
  One mark left: .a1_hz, "yes", "yes", "yes", ""
  Paint circle: "red", .place, .a1_hz, 0.002
 endif
 if .a2_hz <> undefined   
  One mark left: .a2_hz, "yes", "yes", "yes", ""
  Paint circle: "red", .place, .a2_hz, 0.002
 endif
endproc
```